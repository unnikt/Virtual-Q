<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>VirQ.app</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Montserrat&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/calendar.css">

    <link rel="shortcut icon" href="">
    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="/__/firebase/7.14.5/firebase-app.js"></script>
    <!-- Add Firebase products that you want to use -->
    <script src="/__/firebase/7.14.5/firebase-auth.js"></script>
    <!-- Initialize Firebase -->
    <script src="/__/firebase/init.js"></script>
    <script>
        // const auth = firebase.auth();
        // auth.onAuthStateChanged(user => { if (!user) window.location = "/"; })
        function redirect(page) { window.location = page + auth.currentUser.uid; }
    </script>
</head>

<body data-gr-c-s-loaded="true">
<style>
    .actionbar{
        position: fixed;
        border-bottom: 1px solid var(--primary-color);
        box-shadow: 2px 2px 2px 2px var(--shadow-color);
        width: 100%;
        margin-bottom: 24px;
        background-color: white;
    }
</style>
    <div class="actionbar" style="display: flex;">
        <p class="apptitle"> VirQ.app</p>
        <i id="mainIcn" class="material-icons gicon-regular" style="z-index: 2;" onclick="togmenu()">menu</i>
    </div>
    <canvas style="height: 100px;"></canvas>
    <div id="mainNav" class="overlay">
        <div class="overlay-content">
            <a class="tile" href="javascript:redirect('skedules?uid=')">Calendar</a>
            <a class="tile" href="javascript:redirect('settings?uid=')">Settings</a>
            <a class="tile" href="javascript:auth.signOut();">Log out</a>
            <p class="theme">Keep the distance - Save time</p>
        </div>
    </div>
    <style>
        input[type=date] {
            padding: 0 12px;
            text-align: center;
            font-size: 0.8em;
        }
    </style>
    <div id="divCalendar">
        <div class="cal-header">
            <!-- <i id="prev-m" class="material-icons cal-icon" onclick="minimise()">expand_less</i> -->
            <i id="prev-m" class="material-icons " onclick="localCMY('mon', 'prev')">chevron_left</i>
            <p id="month" style="margin:12px;">Jun</p>
            <i id="next-m" class="material-icons " onclick="localCMY('mon', 'next')">chevron_right</i>
            <i id="prev-y" class="material-icons " onclick="localCMY('year', 'prev')">chevron_left</i>
            <p id="year" style="margin:12px;">2020</p>
            <i id="next-y" class="material-icons " onclick="localCMY('year', 'next')">chevron_right</i>
            <i id="icnfold" class="material-icons " onclick="fold('icnfold','cal-container')">expand_less</i>
        </div>
        <div id="cal-container" class="cal-container">
            <div id="cal-dates" class="cal-dates" hidden="">
                <div class="cal-wday" id="Sun">Sun</div>
                <div class="cal-wday" id="Mon">Mon</div>
                <div class="cal-wday" id="Tue">Tue</div>
                <div class="cal-wday" id="Wed">Wed</div>
                <div class="cal-wday" id="Thu">Thu</div>
                <div class="cal-wday" id="Fri">Fri</div>
                <div class="cal-wday" id="Sat">Sat</div>
                <div class="cal-wday"></div>
                <div class="cal-wday" id="1">1</div>
                <div class="cal-wday" id="2">2</div>
                <div class="cal-wday" id="3">3</div>
                <div class="cal-wday" id="4">4</div>
                <div class="cal-wday" id="5">5</div>
                <div class="cal-wday" id="6" style="background: rgb(160, 176, 234);">6</div>
                <div class="cal-wday" id="7">7</div>
                <div class="cal-wday" id="8">8</div>
                <div class="cal-wday" id="9">9</div>
                <div class="cal-wday" id="10">10</div>
                <div class="cal-wday" id="11">11</div>
                <div class="cal-wday" id="12">12</div>
                <div class="cal-wday" id="13" style="border-left: 2px solid rgb(240, 51, 234);">13</div>
                <div class="cal-wday" id="14">14</div>
                <div class="cal-wday" id="15">15</div>
                <div class="cal-wday" id="16">16</div>
                <div class="cal-wday" id="17">17</div>
                <div class="cal-wday" id="18">18</div>
                <div class="cal-wday" id="19">19</div>
                <div class="cal-wday" id="20">20</div>
                <div class="cal-wday" id="21">21</div>
                <div class="cal-wday" id="22">22</div>
                <div class="cal-wday" id="23">23</div>
                <div class="cal-wday" id="24">24</div>
                <div class="cal-wday" id="25">25</div>
                <div class="cal-wday" id="26">26</div>
                <div class="cal-wday" id="27" style="border-left: 2px solid rgb(240, 51, 234);">27</div>
                <div class="cal-wday" id="28">28</div>
                <div class="cal-wday" id="29">29</div>
                <div class="cal-wday" id="30">30</div>
            </div>
        </div>
        <div class="grid nopad" id="evnt-lst">
            <label class="date-hdr">Sat Jun 13 2020</label>
            <div class="event" onclick="showCheckin()">
                <label>18:59</label>
                <label >Tony's Haircut Lorem ipsum, dolor sit </label>
                <label >Mens Haircut</label>
                <label class="green" >Arrived</label>
            </div>
            <div class="event" onclick="showCheckin()">
                <label>18:59</label>
                <label >Tony's Haircut </label>
                <label >Mens Haircut</label>
                <label class="amber">Arrived</label>
            </div>
            <div class="event" onclick="showCheckin()">
                <label>18:59</label>
                <label >Tony's Haircut Lorem ipsum, dolor sit </label>
                <label >Mens Haircut</label>
                <label class="red">Arrived</label>
            </div>
            <div class="event">
                <label>18:59</label>
                <label style="display: inline;">Tony's Haircut</label>
                <i class="material-icons" style="font-size:1em;float:right;">more_vert</i>
            </div>
            <div class="event"><label>18:59</label><label style="display: inline;">Tony's Haircut</label><i
                    class="material-icons" style="font-size:1em;float:right;">more_vert</i></div>
            <div class="event"><label>18:59</label><label style="display: inline;">Tony's Haircut</label><i
                    class="material-icons" style="font-size:1em;float:right;">more_vert</i></div>

            <label class="date-hdr">Sat Jun 27 2020</label>
            <div class="bbdr "><label>00:00</label><label style="display: inline;">Tony's Haircut</label><i
                    class="material-icons" style="font-size:1em;float:right;">more_vert</i></div>
        </div>
    </div>
    <style>
        .slideup {
            background: var(--light-background);
            width: 0%;
            display: none;
            transition: height 2s;
        }
    </style>
    <div class="modal slideup" id="divCheckin">
        <style>
            .icons-bar>a {
                text-decoration: none;
                padding: 0.2em;
                color: var(--primary-color);
            }
        </style>
        <div class="grid">
            <i id="mainIcn" class="material-icons gicon-regular" onclick="hideCheckin()">arrow_back</i>
            <div class="icons-bar bbdr">
                <p style="color: var(--accent-color); width: 70%;" id="bname">{{bname}}</p>
                <a id="icn01" class="material-icons" href="https://g.page/curtisaviation?share">place</a>
                <a id="icn01" class="material-icons" href="tel:0466149150"> call</a>
                <a id="icn01" class="material-icons" href="mailto:unnikt@gmail.com"> email</a>
                <a id="icn01" class="material-icons" href="https://curtisaviation.com.au/"> public</a>
            </div>
            <div>
                <label id="start" style="color:var(--primary-color);font-weight: bold;">{{start}}</label>
                <label id="sname" style="display: block;">{{sname}}</label>
            </div>
            <div style="display: grid; grid-template-columns: 11fr 1fr;">
                <select id="status">
                    <option value="ontime">Select your current status</option>
                    <option value="ontime">On my way</option>
                    <option value="delayed">Wont make it</option>
                    <option value="arrived">I have arrived</option>
                    <option value="checkout">I am leaving</option>
                </select>
                <i class="material-icons" style="padding: 12px; margin: 12px;"
                    onclick="redirect('skedules?uid=')">send</i>
            </div>
            <div id="arrived" hidden>
                <label>Scan your QR Code to check in</label>
                <div id="qrdiv" style="margin: 12px;" data-pid="{{aid}}"></div>
            </div>
            <div id="delayed" hidden>
                <button style="width: 150px;">Reschedule</button>
                <button style="width: 150px;">Cancel</button>
            </div>
        </div>
        <script type="text/javascript" src="js/qrcode.js"></script>
        <script>
            const qrdiv = get('qrdiv');
            const optStatus = get('status');
            new QRCode("qrdiv", { text: qrdiv.getAttribute('data-pid'), width: 200, height: 200 });

            var visDiv = null;
            optStatus.addEventListener('change', e => {
                if (visDiv) visDiv.hidden = true;
                visDiv = get(optStatus.value); visDiv.hidden = false;
            });
            function get(e) { return document.getElementById(e); }
        </script>
    </div>


    <form id="frmcheckin" action="/checkin" method="POST" hidden="">
        <input type="text" name="aid">
        <input type="text" name="bname">
        <input type="text" name="sname">
        <input type="text" name="start">
        <input type="text" name="end">
    </form>

    <script src="js/app.js"></script>
    <script src="js/calendar.js"></script>
    <script>

        const divCheckin = get('divCheckin').style;
        function showCheckin() { divCheckin.width = '100%'; divCheckin.display = 'block'; }
        function hideCheckin() { divCheckin.width = '0%'; divCheckin.display = 'none'; }

        const urlParams = new URLSearchParams(window.location.search);
        const uid = urlParams.get('uid');
        const bid = urlParams.get('bid');
        setCurrentDate([today.getFullYear(), today.getMonth() + 1, today.getDate()].join('-'));
        drawCalendar();
        setColor(currDate, blue);

        // fetchEvents();
        function fetchEvents() {
            spinner();
            inputs.id = (uid) ? 'uid' : (bid) ? 'bid' : null;
            inputs.val = (uid) ? uid : (bid) ? bid : null;

            params.body = JSON.stringify(inputs);
            fetch("/getevents", params)
                .then(response => response.json()
                    .then(data => { showEvents(data.events, 'evnt-lst'); spinner('stop'); }));
        }
        function localCMY(mon_year, prev_next) {
            changeMonthYear(mon_year, prev_next);
            fetchEvents();
        }
    </script>
    <script>
        function get(el) { return document.getElementById(el) }
        const mainNav = get('mainNav');
        const mainIcn = get('mainIcn');
        function togmenu() {
            if (mainNav.style.height == '100%') { mainNav.style.height = "0%";  mainIcn.innerText = 'menu'; }
            else { mainNav.style.height = '100%';  mainIcn.innerText = 'close'; }
        }
    </script>


</body>

</html>